<!DOCTYPE html>

<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="dw2e-DRAGANDDROP-14915-PuertaGallegoAlfredo.css">
    <title>Drag and drop - alfredoPuertaDW2E</title>

    <script>
        var contenedores = [];
        //botones
        var elemsAñadir = [];
        var elemsBorrar = [];

        var etiquetas = [];
        var bookmarks = [];

        var indexBM = 0, indexEt = 0;

        var elemSeleccionado;

        function iniciar() {
            var cajaBookmarks = crearNodo('div', document.body, 'cajaBM', 'contenedor', '');
                contenedores.push(cajaBookmarks);
            var cajaContenido = crearNodo('div', document.body, 'cajaCont', 'contenedor', '');
                contenedores.push(cajaContenido);
            var cajaEtiquetas = crearNodo('div', document.body, 'cajaEtiquetas', 'contenedor', '');
                contenedores.push(cajaEtiquetas);
            // crearElementosFuncionales(cajaBookmarks, cajaContenido, cajaEtiquetas);
            
            for (let i = 0; i < contenedores.length; i++) {
                
                // var heading = crearNodo('div', contenedores[i], 'heading' + (i + 1), 'heading', '');
                if (i == 0) {
                    var heading1 = crearNodo('div', contenedores[i], 'heading' + (i + 1), 'heading', 'BOOKMARKS');
                    // heading.innerHTML = 'BOOKMARKS';
                    var etAñadir1 = crearNodo('div', contenedores[i], 'añadir' + (i + 1), 'etiqueta-añadir', 'añadir +');
                    var etBorrar1 = crearNodo('div', contenedores[i], 'borrar' + (i + 1), 'etiqueta-borrar', 'borrar drag and drop aqui');
                } else if (i == 1) {
                    var heading2 = crearNodo('div', contenedores[i], 'heading' + (i + 1), 'heading', 'CONTENIDO');
                    // heading.innerHTML = 'CONTENIDO';
                    var labelTitulo = crearNodo('label', contenedores[i], '', 'label', 'titulo');
                    var titulo = crearNodo('input', contenedores[i], 'titulo', 'filter', '');
                    
                    var labelURL = crearNodo('label', contenedores[i], '', 'label', 'url');
                    var url = crearNodo('input', contenedores[i], 'url', 'filter', '');
                    
                    var labelDescrip = crearNodo('label', contenedores[i], '', 'label', 'descrip');
                    var descrip = crearNodo('input', contenedores[i], 'descripcion', 'filter', '');
                    var etBorrar2 = crearNodo('div', contenedores[i], 'borrar' + (i + 1), 'etiqueta-borrar', 'borrar drag and drop aqui');
                    
                } else {
                    var heading3 = crearNodo('div', contenedores[i], 'heading' + (i + 1), 'heading', 'ETIQUETAS');
                    // heading.innerHTML = 'ETIQUETAS';
                    var etAñadir2 = crearNodo('div', contenedores[i], 'añadir' + (i + 1), 'etiqueta-añadir', 'añadir +');
                    var etBorrar3 = crearNodo('div', contenedores[i], 'borrar' + (i + 1), 'etiqueta-borrar', 'borrar drag and drop aqui');   
                }
            }

            //cajas principales (donde serán arrastradas las etiquetas)
            // heading1.addEventListener("drop", drop);
            // heading1.addEventListener("dragover", allowDrop);
            
            heading2.addEventListener("drop", drop);
            heading2.addEventListener("dragover", allowDrop);
            
            // heading3.addEventListener("drop", drop);
            // heading3.addEventListener("dragover", allowDrop);

            //crear etiquetas pulsando en "añadir +"
            etAñadir1.addEventListener("click", clickAñadir);
            etAñadir1.addEventListener("mouseover", function(){
                this.style.cursor = 'pointer';
            });

            etAñadir2.addEventListener("click", clickAñadir);
            etAñadir2.addEventListener("mouseover", function(){
                this.style.cursor = 'pointer';
            });

            //borrar las etiquetas creadas al pulsar en "borrar"
            etBorrar1.addEventListener("click", clickBorrar);
            etBorrar1.addEventListener("mouseover", function(){
                this.style.cursor = 'pointer';
            }); 
            
            etBorrar2.addEventListener("click", clickBorrar);
            etBorrar2.addEventListener("mouseover", function(){
                this.style.cursor = 'pointer';
            });

            etBorrar3.addEventListener("click", clickBorrar);
            etBorrar3.addEventListener("mouseover", function(){
                this.style.cursor = 'pointer';
            });

            //borrar las etiquetas creadas al arrastrarlas en "borrar"
            //añadir:
            // - dragstart
            // - drag
            // - dragend
            // - drop
            etBorrar1.addEventListener("dragover", allowDrop);
            // etBorrar1.addEventListener("drop", drop);
            etBorrar1.addEventListener("drop", borrar);
            // etBorrar1.addEventListener("drop", drag);

            etBorrar2.addEventListener("dragover", allowDrop);
            // etBorrar2.addEventListener("drop", drop);
            etBorrar2.addEventListener("drop", borrar);
            // etBorrar2.addEventListener("drop", drag);

            etBorrar3.addEventListener("dragover", allowDrop);
            // etBorrar3.addEventListener("drop", drop);
            etBorrar3.addEventListener("drop", borrar);
            // etBorrar3.addEventListener("drop", drag);
        }

        function clickAñadir(cajaBookmarks, cajaContenido, cajaEtiquetas, cajaBMs, cajaETs) {
            var nodoPadre = this.parentElement;
            if(nodoPadre.id === 'cajaBM'){
                var nuevaCajaBM = crearNodo('div', nodoPadre, 'etiqueta' + indexBM++, 'etiqueta', 'bookmark ' + indexBM);
                nuevaCajaBM.setAttribute('draggable', 'true');
                nuevaCajaBM.addEventListener("dragstart", drag);
                bookmarks.push(nuevaCajaBM);
                // console.log(nuevaCajaBM);
            } else if(nodoPadre.id === 'cajaEtiquetas'){
                // console.log(nuevaCajaBM);
                var nuevaCajaEt = crearNodo('div', nodoPadre, 'etiqueta' + indexEt++, 'etiqueta', 'etiqueta ' + indexEt);
                nuevaCajaEt.setAttribute('draggable', 'true');
                nuevaCajaEt.addEventListener("dragstart", drag);
                etiquetas.push(nuevaCajaEt);
            }
        }

        function clickBorrar() {
            try{
                this.nextSibling.remove();
            }catch (err){/*nada aquí*/}
        }

        function allowDrop(ev) {
            // console.log('se dispara el evento "dragover" -> allowDrop\n-->' + ev.type);
            ev.preventDefault();
        }

        function drop(ev) {
            ev.preventDefault();
            // console.log(ev.target);

            // var data = ev.dataTransfer.getData("text");
            // ev.target.appendChild(document.getElementById(data));

            if(ev.target.id === 'heading2'){
                // console.log('heading2');
                ev.target.addEventListener('drop', cambiarContenedor);
            } else {
                // console.log('otro');
                ev.target.addEventListener('drop', borrar);
            }
        }

        function drag(ev){
            // console.log(ev.target);
            // console.log('paso por drag');
            elemSeleccionado = ev.target;
        }

        function borrar(){
            elemSeleccionado.remove();
            // ev.target.remove();
        }

        function cambiarContenedor(){
            // console.log('paso por cambiarContenedor');
            // console.log(this);
            this.parentNode.appendChild(elemSeleccionado);
            // console.log(elemSeleccionado.parentNode);
        }

        function crearNodo(tipo, padre, id, clase, inner) {
            var nodo = document.createElement(tipo);
            if (id != '') { nodo.id = id; }
            if (clase != '') { nodo.className = clase; }
            if (inner != '') { nodo.innerHTML = inner; }
            padre.appendChild(nodo);
            return nodo;
        }

        window.onload = iniciar;
    </script>
</head>

<body>

</body>

</html>